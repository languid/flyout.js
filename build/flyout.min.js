!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery"),require("helper.js"),require("lodash"),require("minivents")):"function"==typeof define&&define.amd?define(["exports","jquery","helper.js","lodash","minivents"],e):e(t.Flyout=t.Flyout||{},t.$,t.helper,t._,t.Events)}(this,function(t,e,i,n,s){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e="default"in e?e.default:e,n="default"in n?n.default:n,s="default"in s?s.default:s;var h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=e(window),a=e(document.body),l=function(){function t(i,h,r){var l=this;o(this,t),s(this),this._anchor=null,this._where={},this._isHide=!0,this._currentAnchor=null,this._currentAnchorBox={},this._unbindDocument=null,this.setting=Object.assign({destroy:!1,alone:!1,clickDocumentHide:!0,sameAnchorHide:!0,hideDirect:"default",stayTime:0,anchorStay:!1,hideOffset:10,showOffset:10,showDuration:150,easing:"swing",classStyle:"",alignment:"center",placement:"top",arrow:!0,stop:!1,events:{}},h);var c=void 0;return this.emit("created"),"string"==typeof i?(c=t.template[i],c?(i=e(c.element),this.setting=Object.assign({},c.options,h)):i=e(i),a.append(i)):i=e(i),i.attr("id")&&!document.getElementById(i.attr("id"))&&a.append(i),r&&Object.assign(this,n.omit(r,Object.keys(this))),i.data("flyout")?i.data("flyout"):(i.data("flyout",this),this.primaryId=t.primaryId++,t.cache[this.primaryId]=this,n.forEach(this.setting.events,function(t,e){l.on(e,t.bind(l))}),void this._baseFlyoutConstructor(i))}return h(t,[{key:"_baseFlyoutConstructor",value:function(t){this.element=t,this.alone=this.setting.alone,this._originalHTML=t.html(),this.element.addClass("flyout").css({position:"absolute"}),this.setting.stop&&this.element.click(function(t){t.stopPropagation()}),this.setting.anchor&&(this._anchor=this.setting.anchor),this.element.addClass(this.setting.classStyle),this._placement=this.setting.placement,this._alignment=this.setting.alignment,this.setting.arrow&&(this._arrow=e('<span class="flyout-arrow"></span>'),this.element.append(this._arrow)),this.emit("mounted")}},{key:"arrow",value:function(){this._arrow=e('<span class="flyout-arrow"></span>'),this.element.append(this._arrow)}},{key:"show",value:function(t,e,i,n){this._baseFlyoutShow(t,e,i,!!n)}},{key:"hide",value:function(t){this._documentBind(!0),this._baseFlyoutHide(t)}},{key:"position",value:function(){var t=this;if(!this._isHide)return this._getTopLeft(),this.setting.arrow&&this._arrowPostion(),this.element.animate(this._endPosition,{easing:this.setting.easing,duration:this.setting.showDuration,complete:function(){t._isHide=!1}}),this}},{key:"lastAnchor",value:function(){return this._currentAnchor}},{key:"_createStayTimer",value:function(){var t=this;this.setting.stayTime&&(this._clearStay(),this._stayTimer=i.delay(function(){t.hide()},this.setting.stayTime+this.setting.showDuration))}},{key:"_clearStay",value:function(){clearTimeout(this._stayTimer),this._stayTimer=null}},{key:"_documentBind",value:function(t){var e=this,n=this;this.setting.clickDocumentHide!==!1&&(t&&this._unbindDocument?(this._unbindDocument(),this._unbindDocument=null):this._unbindDocument||(this._unbindDocument=i.documentClick(this.element,function(){e.setting.clickDocumentHide===!0?e.hide():"function"==typeof n.setting.clickDocumentHide&&e.setting.clickDocumentHide.call(n)})))}},{key:"destroy",value:function(){var e=this.primaryId;this.element.remove(),t.cache[e]=null,delete t.cache[e]}},{key:"recover",value:function(){this.element.html(this._originalHTML)}},{key:"_arrowPostion",value:function(){var t=this.element.find("span.flyout-arrow").attr("class","flyout-arrow");t.css({left:"",right:""});var e=void 0;switch(this._where.at){case"top":e="bottom";break;case"bottom":e="top";break;case"left":e="right";break;case"right":e="left"}var i=0;this._currentAnchorBox.width<=30&&(i=this._currentAnchorBox.width/2),"right"==this._currentAlignment?this._startPosition.left+=i:"left"==this._currentAlignment&&(this._startPosition.left-=i+9),t.addClass(e+" "+e+"-"+this._currentAlignment)}},{key:"_baseFlyoutShow",value:function(i,n,s,o){var h=this,r=this,a=this.element,l=!1;i?i.jquery||(i=e(i)):i=this._anchor,n||(n=this._placement),s||(s=this._alignment),i&&(this._currentAnchor&&this._currentAnchor[0]==i[0]&&(l=!0),this._currentAnchor=i,this._currentPlacement=n,this._currentAlignment=s,t.currentShowFlyout=this,i&&this._getTopLeft(o),this.alone||this._hideAllVisibleFlyout(),l&&this.setting.sameAnchorHide&&!this._isHide?this.hide():(!l||l&&!this.setting.sameAnchorHide||l&&this.setting.sameAnchorHide&&this._isHide)&&(this._documentBind(!0),this._createStayTimer(),this.setting.arrow&&r._arrowPostion(),a.show().css(this._startPosition).stop().animate(this._endPosition,{easing:this.setting.easing,duration:this.setting.showDuration,complete:function(){h._isHide=!1,h._documentBind(),h.emit("shown")}}),this.emit("show")))}},{key:"_baseFlyoutHide",value:function(t){this._clearStay();var e=this,i={opacity:0},n=this.setting.hideOffset;switch(this._where.at){case"bottom":i.top=this.element.offset().top+n;break;case"top":i.top=this.element.offset().top-n;break;case"left":i.left=this.element.offset().left-n;break;case"right":i.left=this.element.offset().left+n}t===!0?e._hideElement():this.element.stop().animate(i,{easing:this.setting.easing,duration:160,complete:function(){e._hideElement()}}),this.emit("hide")}},{key:"_hideElement",value:function(){this.element.hide(),this._isHide=!0,this.emit("hidden"),this.setting.destroy&&this.destroy()}},{key:"_hideAllVisibleFlyout",value:function(){var i=this.primaryId;e.each(t.cache,function(t,e){!e||i==t||e._isHide||e.alone||e.hide()})}},{key:"_getTopLeft",value:function(t){var e=this._currentAnchor,i=this._currentAnchorBox={left:e.offset().left,right:e.offset().left+e.outerWidth(),top:e.offset().top,bottom:e.offset().top+e.outerHeight(),width:e.outerWidth(),height:e.outerHeight()},n={width:this.element.outerWidth(),height:this.element.outerHeight()};switch(this._currentScrollTop=r.scrollTop(),this._startPosition={opacity:0},this._endPosition={opacity:1},this._currentPlacement){case"top":this._where.at="top",this._fitTop(i,n)||t||(this._fitBottom(i,n),this._where.at="bottom"),this._alignHorizontally(i,n);break;case"bottom":this._where.at="bottom",this._fitBottom(i,n)||t||(this._fitTop(i,n),this._where.at="top"),this._alignHorizontally(i,n);break;case"left":this._where.at="left",this._fitLeft(i,n)||t||(this._fitRight(i,n),this._where.at="right"),this._alignVertically(i,n);break;case"right":this._where.at="right",this._fitRight(i,n)||t||(this._fitLeft(i,n),this._where.at="left"),this._alignVertically(i,n);break;case"auto":}}},{key:"_fitTop",value:function(t,e){return this._nextTop=t.top-e.height,this._nextAnimTop=this._nextTop-this.setting.showOffset,this._nextTop>=0&&this._nextAnimTop>this._currentScrollTop&&this._nextAnimTop+e.height<t.top}},{key:"_fitBottom",value:function(t,e){return this._nextTop=t.bottom,this._nextAnimTop=t.bottom+this.setting.showOffset,this._nextTop>=0&&this._nextAnimTop-this._currentScrollTop+e.height<r.height()}},{key:"_fitLeft",value:function(t,e){return this._nextLeft=t.left-e.width+this.setting.showOffset,this._nextAnimLeft=this._nextLeft-2*this.setting.showOffset,this._nextLeft>=0&&this._nextLeft+e.width<r.width()}},{key:"_fitRight",value:function(t,e){return this._nextLeft=t.right-this.setting.showOffset,this._nextAnimLeft=this._nextLeft+2*this.setting.showOffset,this._nextLeft>=0&&this._nextLeft+e.width<r.width()}},{key:"_fitAlignLeft",value:function(t,e){return this._nextLeft=t.left,t.left+e.width<r.width()}},{key:"_fitAlignRight",value:function(t,e){return this._nextLeft=t.right-e.width,t.right>e.width}},{key:"_alignVertically",value:function(t,e){"center"==this._currentAlignment?this._nextTop=t.top+t.height/2-e.height/2:"top"==this._currentAlignment?this._nextTop=t.top:"bottom"==this._currentAlignment&&(this._nextTop=t.bottom-e.height),this._startPosition.top=this._nextTop,this._startPosition.left=this._nextLeft,this._endPosition.left=this._nextAnimLeft}},{key:"_alignHorizontally",value:function(t,e){var i=r.width();"center"==this._currentAlignment&&(this._nextLeft=t.left+t.width/2-e.width/2,this._nextLeft+e.width>i?this._currentAlignment="right":this._nextLeft<0&&(this._currentAlignment="left")),"left"!=this._currentAlignment||this._fitAlignLeft(t,e)?"right"!=this._currentAlignment||this._fitAlignRight(t,e)||(this._fitAlignLeft(t,e),this._currentAlignment="left"):(this._fitAlignRight(t,e),this._currentAlignment="right"),this._startPosition.left=this._nextLeft,this._startPosition.top=this._nextTop,this._endPosition.top=this._nextAnimTop}}],[{key:"hideAllFlyout",value:function(){e(".flyout:visible").each(function(){var t=e(this),i=t.data("flyout");i&&t.is(":visible")&&i.hide()})}},{key:"template",get:function(){return{base:{element:'<div class="flyout box"><div class="mod"><div class="bd"></div><div class="ft"></div></div></div>'}}}}]),t}();l.primaryId=0,l.cache={},l.currentShowFlyout=null;var c=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.noop,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o='\n\t\t<div class="flyout-box flyout-confirm">\n\t\t\t<p class="text"></p>\n\t\t\t<div class="buttons">\n\t\t\t\t<button role="cancel" class="btn btn-sm btn-secondary">取消</button>\n\t\t\t\t<button role="ok" class="btn btn-sm btn-primary">确认</button>\n\t\t\t</div>\n\t\t</div>',h=new l(o,{destroy:!0,events:{mounted:function(){var t=this;this.element.on("click","button[role]",function(i){var s=e(i.target).attr("role");"ok"==s&&n.call(t),t.hide()})}}}),r=h.element.find("p.text");return s?(r.css("width","auto").show().html(s),h.element.outerWidth()>300&&r.width("250")):r.hide().html(""),h.show(t,"top","center"),h},u=function(t,i,n){t=e(t);var s=t.data("flyout");if(null==s){var o={placement:"top",alignment:"center",destroy:!0,stayTime:800,classStyle:"info",events:{hidden:function(){t.data("flyout",null)}}};"string"==typeof n&&n.length?o.classStyle="alert-"+n:(e.isPlainObject(n)||"undefined"==typeof n)&&(Object.assign(o,n),o.classStyle.length&&(o.classStyle="alert-"+o.classStyle)),s=new l('<div class="flyout-tips alert"></div>',o),s.element.html(i).mouseenter(function(){t.data("flyout",s),s._clearStay()}).mouseleave(function(){t.data("flyout",null),s._createStayTimer()}),s.arrow(),s.show(t)}return s};t.confirm=c,t.tips=u,t.default=l,Object.defineProperty(t,"__esModule",{value:!0})});